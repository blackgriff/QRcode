const express = require('express');
const router = express.Router();
const Driver = require('../models/Driver');
const QRCode = require('qrcode');

// Get all drivers
router.get('/drivers', async (req, res) => {
    try {
        const drivers = await Driver.find();
        res.json(drivers);
    } catch (err) {
        res.status(500).send(err);
    }
});

// Generate QR code for driver
router.post('/drivers/:id/qrcode', async (req, res) => {
    const driver = await Driver.findById(req.params.id);
    const qrCodeData = `https://app.com/driver/${driver.id}`;
    QRCode.toDataURL(qrCodeData, async (err, url) => {
        if (err) return res.status(500).send('QR code generation failed');
        driver.qrCodeUrl = url;
        await driver.save();
        res.json({ qrCodeUrl: url });
    });
});

module.exports = router;
